---
title: "실행 계획과 쿼리 최적화"
date: 2025-01-16 18:00:00
tags: 
  - Database
  - Index
---

## 인덱스 설계

데이터베이스의 데이터가 커질수록 데이터를 조회하는데 시간이 오래걸리게 된다. 
이를 해결하기 위해 인덱스를 사용하게 되는데, 남용하게 될 경우 오히려 데이터베이스의 성능을 저하시킬 수 있다.
그래서 인덱스를 효율적으로 사용하기 위해서는 인덱스의 설계를 잘 해야한다.

### 효율적인 인덱스 설계

다음은 효율적인 인덱스 설계를 위한 몇 가지 팁이다.

- `WHERE` 절에 자주 사용되는 컬럼에 인덱싱을 하는 것이 좋다.
- `SELECT` 절에 자주 사용되는 컬럼들을 조합해서 인덱스로 만들어 커버링 인덱스를 사용하는 것이 좋다. 
- `JOIN` 절에 자주 사용되는 컬럼에 인덱싱을 하는 것이 좋다.
- `ORDER` BY 절에 자주 사용되는 컬럼에 클러스터형 인덱스를 사용하는 것이 좋다.

### 지양해야할 인덱스 설계

다음은 지양해야할 인덱스 설계를 위한 몇 가지 팁이다.

- 대용량 데이터가 자주 입력되는 경우 클러스터형 인덱스의 페이징이 빈번하게 발생해 시스템에 부하가 걸릴 수 있다. 때문에 클러스터 대신 세컨더리 인덱스를 사용하는 것이 좋을 수 있다.
- 데이터 중복도가 높은 컬럼에 인덱싱을 하는 것은 효율적이지 않다. 중복도가 높은 컬럼에 인덱싱을 하게 되면 인덱스의 크기가 커지고, 인덱스를 탐색하는데 시간이 오래걸릴 수 있다.
- 인덱스를 많이 사용하게 되면 인덱스를 관리하는데 시간이 오래걸리게 되고, 인덱스의 크기가 커지게 된다. 때문에 인덱스를 많이 사용하는 것은 지양해야한다.
- 자주 사용되지 않는 컬럼에 인덱싱을 하는 것은 효율적이지 않다.

## 커버링 인덱스와 다중 컬럼 인덱스



- 커버링 인덱스(Covering index)

  **쿼리 조회 결과가 인덱스에 해당하는 컬럼 값으로만 이루어진 것을 커버링 인덱스라고 합니다.**

  **커버링 인덱스로 처리되는 쿼리는 디스크의 레코드를 읽지 않아도 되기 때문에 그만큼 랜덤 엑세스가 줄어들고 성능은 빨라집니다.**

- 다중 컬럼 인덱스(Multi-column index, 복합 인덱스)

  **다중 컬럼 인덱스는 2개 이상의 컬럼으로 이루어진 인덱스입니다.**

  **2개의 컬럼으로 이루어진 인덱스가 있을때,**

  **인덱스의 두 번째 컬럼은 첫 번째 컬럼에 의존해서 정렬된다는 특징이 있다는 것을 고려해서 사용해야합니다.**


## 인덱스 스캔 방식

인덱스 스캔 방식은 인덱스를 탐색하는 방식을 의미한다. 인덱스 스캔 방식에는 여러가지가 있는데, 그 중에서 대표적인 방식은 다음과 같다.
B Tree 기준으로 설명하자면, 인덱스 레인지 스캔은 검색 해야할 인덱스의 범위가 결정 됐을때 사용하는 방식이다.
루트 노드, 브랜치 노드를 거쳐 검색 시작점 리프 노드를 찾고,
리프 노드간의 링크를 통해 검색 종료점 리프 노드까지 스캔하면서 레코드를 랜덤 엑세스로 읽어 들인다.
인덱스 풀 스캔은 인덱스의 처음부터 끝까지 모두 스캔하는 방식이다.
예를들어 a,b,c 컬럼에 복합 인덱스가 걸려있고 쿼리의 조건절에는 b 또는 c 컬럼이 들어가 있을 경우 인덱스 풀 스캔이 발생한다. 
테이블 풀 스캔보다는 효율적이다.

## 실행 계획

데이터베이스에서 쿼리를 실행할 때 데이터베이스의 옵티마이저가 쿼리를 실행하기 위한 최적의 방법을 결정하는데, 이를 실행 계획이라고 한다.
옵티마이저는 쿼리를 실행하기 위해 여러 실행 계획을 생성하고, 각 실행 계획의 비용을 계산하여 가장 적합한 실행 계획을 선택한다.

이 실행 계획은 데이터베이스가 쿼리를 실행하기 위해 어떤 방식으로 데이터를 조회할지에 대한 계획이다.

## 인덱스 동작 확인 방법

## 힌트를 이용한 쿼리 최적화

## 인덱스 성능 측정