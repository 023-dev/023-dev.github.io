<section class="utterances mx-auto mt-10 w-full"></section>

<script>
    const container = document.querySelector("section.utterances");
    const repo = "023-dev/old-023-dev.github.io"; // ì˜ˆ: my-name/my-blog

    const createUtterances = (theme) => {
        if (!container) return;
        container.innerHTML = "";
        const script = document.createElement("script");
        script.src = "https://utteranc.es/client.js";
        script.setAttribute("repo", repo);
        script.setAttribute("issue-term", "pathname");
        script.setAttribute("label", "comment");
        script.setAttribute("theme", theme);
        script.setAttribute("crossorigin", "anonymous");
        script.async = true;
        container.appendChild(script);
    };

    const getTheme = () => {
        return document.documentElement.classList.contains("dark")
            ? "github-dark"
            : "github-light";
    };

    // Initial load
    createUtterances(getTheme());

    // Theme sync logic
    const updateUtterancesTheme = () => {
        const theme = getTheme();
        const iframe =
            document.querySelector<HTMLIFrameElement>(".utterances iframe");

        if (iframe) {
            const message = {
                type: "set-theme",
                theme: theme,
            };
            iframe.contentWindow?.postMessage(message, "https://utteranc.es");
        } else {
            // Fallback if iframe is not yet ready or script hasn't run
            createUtterances(theme);
        }
    };

    const observer = new MutationObserver(updateUtterancesTheme);
    observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ["class"],
    });
</script>
